<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Massive - the asm.js benchmark</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">Massive</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="massive.html">Benchmarks</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <div class="hero-unit">
        <h1>Massive - the asm.js benchmark</h1>
        <br>
        <p>Massive is a JavaScript benchmark that focuses on large, real-world C++ codebases compiled into <a href="http://asmjs.org">asm.js</a> using <a href="http://emscripten.org">Emscripten</a>. This is just one pattern of JavaScript among many, but is very important for things like games, and unique in that the generated JavaScript is often very large and challenging for JavaScript VMs to optimize, which motivates a benchmark dedicated to it.</p>
        <br>
        <p><a href="#" class="btn btn-primary btn-large " onclick="run(); return false" id="the_button">Run the benchmark now! &raquo;</a></p>
      </div>

      <div class="row-fluid">
        <div class="span">
          <h3>Individual Benchmark Results</h3>
            <table class="table table-striped table-bordered table-hover">
              <thead>
                <tr>
                  <th>Benchmark</th>
                  <th><div class="text-center">Result</div></th>
                  <th>Scale</th>
                  <th>What it measures</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>lua-binarytrees</td>
                  <td id="binarytrees-cell"><div id="binarytrees-output" class="text-center"></div></td>
                  <td>seconds (lower numbers are better)</td>
                  <td>GC performance in compiled Lua VM</td>
                </tr>
                <tr>
                  <td>lua-scimark</td>
                  <td id="scimark-cell"><div id="scimark-output" class="text-center"></div></td>
                  <td>MFLOPS (higher numbers are better)</td>
                  <td>numeric computation performance in compiled Lua VM</td>
                </tr>
                <tr>
                  <td>lua-warm-startup</td>
                  <td id="startup-cell"><div id="startup-output" class="text-center"></div></td>
                  <td>seconds (lower numbers are better)</td>
                  <td>how long it takes the compiled Lua VM to be ready to run, after it was previously run</td>
                </tr>
              </tbody>
            </table>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span">
          <h3>FAQ</h3>
          <h4>?</h4>
          <p>! :)</p>
        </div>
      </div>

    </div> <!-- /container -->

    <script>
var ran = false;
function run() {
  if (ran) return;
  ran = true;

  var theButton = document.getElementById('the_button');
  theButton.innerHTML = 'Running benchmarks... (this can take a while)';
  theButton.classList.remove('btn-primary');
  theButton.classList.add('btn-warning');

  var jobs = [
    {
      benchmark: 'binarytrees',
      args: ['binarytrees.lua'],
      calculate: function() {
        return this.msg.runtime/1000;
      },
      normalized: function() {
        return (20.308/this.calculate());
      },
    },
    {
      benchmark: 'scimark',
      args: ['scimark.lua'],
      calculate: function() {
        return /\nSciMark +([\d\.]+)/.exec(this.msg.output)[1]; 
      },
      normalized: function() {
        return (this.calculate()/3.19);
      },
    },
    { // do startup last so there is no network access, and can see previous
      benchmark: 'startup',
      args: null,
      calculate: function() {
        var startups = jobs.map(function(job) { return job.msg.startup });
        startups.sort(function(x, y) { return x - y });
        return startups[Math.floor((startups.length-1)/2)]/1000;
      },
      normalized: function() {
        return 0.10/Math.max(this.calculate(), 1/60); // resolution: 1 frame
      },
    }
  ];

  function finalCalculation() {
    // normalize based on experimental data
    var normalized = jobs.map(function(job) { return 100*job.normalized() });
    console.log('normalized values: ' + normalized);
    return Math.round(normalized.reduce(function(x, y) { return x + y }, 0));
  }

  var curr = 0;
  function runJob() {
    var job = jobs[curr++];
    if (!job) {
      theButton.innerHTML = 'Score: <strong>' + finalCalculation() + '</strong> (higher numbers are better)';
      theButton.classList.remove('btn-warning');
      theButton.classList.add('btn-success');
      return;
    }
    document.getElementById(job.benchmark + '-output').innerHTML = '<b>(..running..)</b>';
      document.getElementById(job.benchmark + '-cell').style = 'background-color: #ffddaa';
    var worker = new Worker('benchmark-worker.js');
    worker.onmessage = function(event) {
      var msg = event.data;
      console.log(JSON.stringify(msg));
      if (msg.benchmark != job.benchmark) throw 'invalid data from benchmark worker';
      job.msg = msg;
      document.getElementById(job.benchmark + '-output').innerHTML = '<b>' + job.calculate() + '</b>';
      document.getElementById(job.benchmark + '-cell').style = 'background-color: #bbccff';
      runJob();
    };
    console.log('requesting benchmark ' + job.benchmark);
    worker.postMessage({
      benchmark: job.benchmark,
      args: job.args
    });
  }
  runJob();
}
    </script>

    <a href="https://github.com/kripken/Massive"><img style="position: absolute; top: 35px; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

  </body>
</html>

